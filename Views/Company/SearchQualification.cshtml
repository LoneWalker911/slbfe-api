
@{
    ViewBag.Title = "SearchQualification";
    Layout = "~/Views/Shared/_CompanyLayout.cshtml";
}
<div id="divSearchQualification" align="center">
    <form id="frmSearchQualification">

        <div class="form-row">
            <div class="form-group col-6">
                <div class="col-12 float-start px-0 px-md-1">
                    <input type="text" class="form-control" placeholder="Search By Qualification" v-model="qualifications.text">
                </div>
            </div>
            <div class="form-group col-6">
                <div class="form-field mb-2">
                    <button type="button" @@click="getCitizenDetailbyQualification" class="col-6 btn btn-primary">Search</button>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="card-body">
                <b-table striped hover :items="details" :fields="fields">
                    <template #cell(Actions)="data">
                        <button type="button" class="btn btn-outline-primary" @@click="getCitizenDetails(data.item.NIC)" title="Show">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-view-list" viewBox="0 0 16 16">
                                <path d="M3 4.5h10a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2zm0 1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1H3zM1 2a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 2zm0 12a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 14z" />
                            </svg>
                        </button>
                    </template>
                </b-table>
            </div>
        </div>
    </form>
</div>

@section Scripts {

    <script>
    Vue.config.devtools = true;

    if (vueSearchQualifications != null) {
        vueSearchQualifications.$destroy();
    }


        var vueSearchQualifications = new Vue({
        el: '#divSearchQualification',
        data: {
            qualifications: {Q:''},
            details: {},
            fields: [
                {
                    key: 'NIC',
                    label: 'NIC',
                    sortable: true
                },
                {
                    key: 'first_name',
                    label: 'First Name',
                    sortable: false
                },
                {
                    key: 'profession',
                    label: 'Profession',
                    sortable: true,
                },
                {
                    key: 'email',
                    label: 'E-mail',
                    sortable: true,
                },
                {
                    key: 'reg_date',
                    label: 'Registration Date',
                    sortable: true,
                },
                {
                    key: 'actions',
                    label: 'Actions',
                }
            ],


        },
        methods: {
            getCitizenDetailbyQualification() {
                $.ajax({
                    url: 'https://edu.santhawa.lk/apiv1/citizen/find?q=' + this.qualifications.text,
                    type: 'GET',
                    contentType: 'application/json',
                    success: function (data, status, response) {
                        console.log(data);
                        vueSearchQualifications.details = JSON.parse(response.responseText);
                    },
                });
            },
            getCitizenDetails(nic) {
                window.open("https://localhost:44354/Company/QualificationDetail?nic=" + nic);
            },
            sendHeaders() {
                $.ajaxSetup({
                    headers: {
                        'Authorization': getCookie('token')
                    }
                });
            }

           
        },
        computed: {
        },
            mounted() {
                this.sendHeaders();
        },
    });
        if (getCookie('token') != null) {
            $.ajax({
                url: "https://edu.santhawa.lk/apiv1/login/check",
                type: "GET",
                beforeSend: function (xhr) { xhr.setRequestHeader('Authorization', getCookie('token')); },
                success: function () { }
            })
                .fail(function (response) { eraseCookie("token"); window.location.href = "/Login"; });
        }
        else {
            window.location.href = "/Login";
        }
    </script>
}





